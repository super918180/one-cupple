<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="./css/index.css">
    <link rel="stylesheet" href="./js/lib/fullpage/zepto.fullpage.css">
    <link rel="stylesheet" href="./js/lib/select/select.css">
    <link rel="stylesheet" href="./js/lib/dialog/dialog.css">
    <script src="./js/lib/flexible.js"></script>
    <title>故事银行</title>
</head>

<body>
    <div class="wp">
        <div class="wp-inner">
            <div class="page page1">
                <img class="center-img bank-of-cupple" src="./images/page1/bank-of-cupple.png" alt="">
                <img class="center-img story-bank" src="./images/page1/story-bank.png" alt="">
                <img class="center-img story-text" src="./images/page1/story-text.png" alt="">
                <img class="center-img one-cupple" src="./images/page1/one-cupple.png" alt="">
                <img class="center-img arrow-down" src="./images/page1/arrow-down.png" alt="">
            </div>
            <div class="page page2">
                <div class="center-img form-text">
                    <div class="center-img form-detail">
                        <textarea id="story" class="center-img form-input" name="" id="" cols="30" rows="10" placeholder='默认文字'></textarea>
                        <div class="form-item">
                            <div class="item-left">
                                <div class="item-tag">昵称</div>
                                <input id="name" class="item-input" type="text" />
                            </div>
                            <div class="item-right">
                                <div class="item-tag">城市</div>
                                <input id="city" class="item-input" type="text" />
                            </div>
                        </div>
                        <div class="form-item">
                            <div class="item-left">
                                <div class="item-tag">星座</div>
                                <select name="select" class="item-select" id="select1">
                                    <option value="0" selected="selected">请选择</option>
                                    <option value="1">魔羯座</option>
                                    <option value="2">水瓶座</option>
                                    <option value="3">双鱼座</option>
                                    <option value="4">白羊座</option>
                                    <option value="5">金牛座</option>
                                    <option value="6">双子座</option>
                                    <option value="7">巨蟹座</option>
                                    <option value="8">狮子座</option>
                                    <option value="9">处女座</option>
                                    <option value="10">天秤座</option>
                                    <option value="11">天蝎座</option>
                                    <option value="12">射手座</option>
                                </select>
                            </div>
                            <div class="item-right">
                                <div class="item-tag">性别</div>
                                <select name="select" class="item-select" id="select2">
                                    <option value="0" selected="selected">请选择</option>
                                    <option value="1">男</option>
                                    <option value="2">女</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="center-img submit" onclick="submit()">提交故事</div>
                <div class="center-img aggree">
                    <img class="aggree-img" src="./images/page2/pressed.png" alt="">
                    <div class="aggree-text">我已阅读并同意《用户协议》</div>
                </div>
                <div id="confirm" class="center-img confirm">
                    <div class="confirm-header">确定要存入故事吗？</div>
                    <div class="confirm-footer">
                        <div class="confirm-footer-left" onclick="drop()">返回修改</div>
                        <div class="confirm-footer-right" onclick="saveStory()">确认存入</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
<script src="./js/lib/zepto.min.js"></script>
<script src="./js/lib/fullpage/zepto.fullpage.js"></script>
<script src="./js/lib/select/select.js"></script>
<script src="./js/lib/dialog/dialog.js"></script>
<script src="./js/scrollTo.js"></script>
<script>
    var xinzuo = null;
    var xingbie = null;
    $(document).ready(function () {
        $('.wp-inner').fullpage();
        var select1 = new Select();
        var select2 = new Select();
        select1.init({
            target: '#select1',
            selected: function (val, txt) {
                xinzuo = txt;
            }
        });
        select2.init({
            target: '#select2',
            selected: function (val, txt) {
                xingbie = txt;
            }
        });
    });

    function submit() {
        // if (checkValue()) {
        //    $('#confirm').show();
        // }
        $('#confirm').show();
        $('.page2').scrollTo({ toT: 1000 })
    }
    function drop() {
        $('.page2').scrollTo({ toT: 0 })
        $('#confirm').hide();
    }
    function saveStory() {
        $(document).dialog({
            type: 'notice',
            content: '<img class="info-icon" src="./images/loading.gif" alt="" /><span class="info-text">正在提交中</span>',
            autoClose: 2500
        });
        var data = getValue();
        try {
            $.post('https://story.cuppieme.com.cn/index/record', {
                nickname: data.name,
                city: data.city,
                constellation: data.xinzuo,
                sex: data.xingbie,
                content: data.story
            }, function (response) {
                if (res.code === 200) {
                    // todo
                } else {
                    $(document).dialog({
                        type: 'notice',
                        infoText: res.msg,
                        autoClose: 2500
                    });
                }
            })
        } catch (e) {
            $(document).dialog({
                type: 'notice',
                infoText: '网络错误，请稍后重试',
                autoClose: 2500
            });
        }
        location.href = './result.html'
    }
    function checkValue() {
        var data = getValue();
        if (!data.story) {
            alert('请填写您的故事')
            return false;
        }
        if (!data.name) {
            alert('请填写您的昵称')
            return false;
        }
        if (!data.city) {
            alert('请填写您的城市')
            return false;
        }
        if (!data.xinzuo) {
            alert('请选择您的星座')
            return false;
        }
        if (!data.xingbie) {
            alert('请填写您的性别')
            return false;
        }
        return true;
    }

    function getValue() {
        var story = $("#story").val();
        var name = $("#name").val();
        var city = $("#city").val();
        return {
            story: story,
            name: name,
            city: city,
            xinzuo: xinzuo,
            xingbie: xingbie
        }
    }
</script>

</html>